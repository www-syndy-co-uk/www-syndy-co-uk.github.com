define("LogonService",["jquery"],function(e){function n(e){this.apiRoot=e}var t=e;return n.prototype.checkLoggedInStatus=function(e,n){e=e||"/",n=n||"/";var e="/authentication/redirectToBlog?destUrl="+e,n="/authentication/redirectToBlog?destUrl="+n,r=this.apiRoot+"/authentication/loginInfo?postLoginUrl="+encodeURIComponent(e)+"&postLogoutUrl="+encodeURIComponent(n);return r+="&callback=?",t.getJSON(r)},n}),define("syndy/ui/login-button",["jquery","LogonService"],function(e,t){var n=e(".login-info"),r=n.find("button.login"),i=n.find("button.logout"),s=null,o=new t(syndy.apiRoot),u=n.find(".throbber");u.show(),n.on("click","button.login",function(e){var t=s.loginUrl;t.indexOf("http")!==0&&(t=syndy.apiRoot+t),window.location.href=t}),n.on("click","button.logout",function(e){var t=s.logoutUrl;t.indexOf("http")!==0&&(t=syndy.apiRoot+t),window.location.href=t});var a=window.location.pathname,f=window.location.pathname;o.checkLoggedInStatus(a,f).done(function(e){u.hide(),s=e,syndy.loginInfo=e;if(s.isUserLoggedIn){var t=s.isUserAdmin?"[A]":"";n.find("span").html(s.user.nickname+" "+t).show(),i.show()}else r.show()})}),define("syndy/odds/Odds",[],function(){function e(){}return e.toString=function(e){if(!e)return"?";var t=e.asFraction,n=e.asDouble;return t?""+t.numerator+"/"+t.denominator:n},e.strToFloat=function(e){var t=e.indexOf("/");if(t<0)return parseFloat(e);var n=e.substring(0,t).trim(),r=e.substring(t+1).trim();return parseInt(n)/parseInt(r)},e}),define("syndy/ajax",["jquery","q"],function(e,t){function n(n,r){return n+=n.indexOf("?")>-1?"&":"?",n+="callback=",n+="?",t(e.getJSON(n,r)).then(function(e){e="string"==typeof e?JSON.parse(e):e;if(e.errors)throw e.url=n,e;return e})}return{getJSON:n}}),define("syndy/promise/utils",["q"],function(e){function t(t){function n(e){return function(t){i[e]=t,r.notify({list:i,response:t,i:e,size:s,count:++o})}}var r=e.defer(),i=[],s=t.length,o=0;t=_.map(t,function(e,t){var r=n(t);return e.then(r,r)});var u=function(){r.resolve(i)};return e.allSettled(t).then(u,u),r.promise}return{allSettledAndNotify:t}}),define("syndy/odds/OddsService",["jquery","underscore","q","syndy/ajax","syndy/promise/utils"],function(e,t,n,r,i){function s(){return!0}function o(e){e=t.extend({},e),this.opts=e,e.host=e.host||"//api.syndy.co.uk",e.port=e.port||"",e.port&&(e.host=e.host+":"+e.port)}return o.prototype.loadMatches=function(){var e=this.opts.host+"/odds/matches";return r.getJSON(e).then(function(e){return{matches:e}})},o.prototype.loadMatch=function(e){var t=this.opts.host+"/odds/matches?matchId="+e;return r.getJSON(t).then(function(e){return{match:e}})},o.prototype.loadMatchSummaries=function(){var e=this.opts.host+"/odds/matchSummaries";return r.getJSON(e).then(function(e){return{matchSummaries:e}})},o.prototype.loadSummariesThenMatches=function(e){var n=this;return e=e||s,this.loadMatchSummaries().then(function(r){var s=t.filter(r.matchSummaries,e),o=t.map(s,function(e,t){return n.loadMatch(e.id)});return i.allSettledAndNotify(o).then(function(e){return{matchSummaries:s,matches:e}})})},o}),define("syndy/odds/MarketModel",["backbone"],function(e){var t=e.Model.extend({initialize:function(){}});return t}),define("syndy/odds/OddsListModel",["backbone","./MarketModel"],function(e,t){var n=e.Collection.extend({model:t});return n}),define("TeamIcons",["underscore"],function(e){function n(n){e.each(t,function(t,r){e.each(t,function(e){n[e]=n[r]})})}function r(){var t=this.icons={},r=this.css={},i="http://upload.wikimedia.org/wikipedia/commons/thumb";t["Bradford Bulls"]="/e/eb/Bullscolours.svg/16px-Bullscolours.svg.png",t["Castleford Tigers"]="/f/fd/Castleford_colours.svg/16px-Castleford_colours.svg.png",t["Catalan Dragons"]="/0/0c/Catalanscolours.svg/16px-Catalanscolours.svg.png",t["Huddersfield Giants"]="/7/73/Giantscolours.svg/16px-Giantscolours.svg.png",t["Hull FC"]="/6/65/Hullcolours.svg/16px-Hullcolours.svg.png",t["Hull Kingston Rovers"]="/8/8f/HKRcolours.svg/16px-HKRcolours.svg.png",t["Leeds Rhinos"]="/5/5f/Rhinoscolours.svg/16px-Rhinoscolours.svg.png",t["London Broncos"]="/f/f8/Quinscolours.svg/16px-Quinscolours.svg.png",t["Salford Red Devils"]="/8/81/Redscolours.svg/16px-Redscolours.svg.png",t["St. Helens"]="/5/5e/Saintscolours.svg/16px-Saintscolours.svg.png",t["Wakefield Wildcats"]="/e/e8/Wcatscolours.svg/16px-Wcatscolours.svg.png",t["Warrington Wolves"]="/f/fd/Wolvescolours.svg/16px-Wolvescolours.svg.png",t["Widnes Vikings"]="/e/ec/Widnes_colours.svg/16px-Widnes_colours.svg.png",t["Wigan Warriors"]="/c/c0/Wigancolours.svg/16px-Wigancolours.svg.png",e.each(t,function(e,n){t[n]=i+e}),n(t),r["Bradford Bulls"]="Bulls",r["Castleford Tigers"]="Castleford",r["Catalan Dragons"]="Catalans",r["Huddersfield Giants"]="Giants",r["Hull FC"]="Hull",r["Hull Kingston Rovers"]="HKR",r["Leeds Rhinos"]="Rhinos",r["London Broncos"]="Broncos",r["Salford Red Devils"]="Reds",r["St. Helens"]="Saints",r["Wakefield Wildcats"]="Wcats",r["Warrington Wolves"]="Wolves",r["Widnes Vikings"]="Widnes",r["Wigan Warriors"]="Wigan",e.each(r,function(e,t){r[t]="sprite_16px-"+e+"_colours"}),n(r)}var t={"Bradford Bulls":["Bradford"],"Castleford Tigers":["Castleford"],"Catalan Dragons":["Catalans","Catalan Dragons"],"Huddersfield Giants":["Huddersfield"],"Hull FC":["Hull"],"Hull Kingston Rovers":["Hull K R","Hull KR"],"Leeds Rhinos":["Leeds"],"London Broncos":["London"],"Salford Red Devils":["Salford"],"St. Helens":["St Helens"],"Wakefield Wildcats":["Wakefield"],"Warrington Wolves":["Warrington"],"Widnes Vikings":["Widnes"],"Wigan Warriors":["Wigan"]};return r.prototype.getIconUrl=function(e){return this.icons[e]},r.prototype.getIconClass=function(e){return this.css[e]},r.prototype.keys=function(){return e.keys(this.icons)},r}),define("syndy/odds/OddsListView",["jquery","backbone","underscore","./Odds","TeamIcons"],function(e,t,n,r,i){function o(e,t){return e.bookmaker<t.bookmaker?-1:e.bookmaker>t.bookmaker?1:0}function u(t,i){function u(t){var n=t.bet1||{},i=t.bet2||{},o=s.getIconClass(n.name),u=s.getIconClass(i.name),a={bookmaker:n.bookmaker||i.bookmaker,bet1:e.extend({},n,{odds:r.toString(n.odds)}),bet2:e.extend({},i,{odds:r.toString(i.odds)}),draw:{odds:t.draw?r.toString(t.draw.odds):""},team1ColourCssClass:o?"sprite "+o:"",team2ColourCssClass:u?"sprite "+u:""},f=e(l(a));return f}if(!t.bets||t.bets.length<1)return null;var a=e(i({match:t})),f=e("#betTemplate").html().trim(),l=n.template(f),c=a.find(".bets tbody");t.bets.sort(o);var h={};e(t.bets).each(function(e,n){n.handicap&&n.handicap.length>0&&n.handicap[0]=="+"&&(n.handicap=n.handicap.substring(1));if(null!=h.bookmaker&&n.bookmaker!=h.bookmaker){var r=u(h);c.append(r),h={}}"Draw"===n.name?h.draw=n:t.team1===n.name?h.bet1=n:h.bet2=n,h.bookmaker=n.bookmaker});var p=u(h);return c.append(p),a}var s=new i,a=t.View.extend({matchTpl:null,initialize:function(e){e=e||{},this.options=e,this.matchTpl=n.template(e.$matchTemplate.html().trim()),this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.attributes;return this.$el.html(""),e.errors?this.$el.html(e.url+", "+e.statusText):this.$el.append(u(e.match,this.matchTpl)),this}});return a.createMatchElement=u,a}),define("syndy/ui/latest-odds",["jquery","underscore","syndy/odds/Odds","syndy/odds/OddsService","syndy/odds/OddsListModel","syndy/odds/OddsListView","TeamIcons"],function(e,t,n,r,i,s,o){function l(t){function u(t){e(".loading").hide(),e(".filter").show();var r=(new Date).getTime()-n;e(".loadTime").text("Loaded "+t.matches.length+" markets in "+r+"ms"),o.resolve(t.matches)}if(!t)throw new Error("matchFilter is mandatory");var n=(new Date).getTime(),r=e(".matches").first();r.html(""),e(".loading").show(),e(".filter").hide();var o=e.Deferred();return a.loadSummariesThenMatches(t).then(u,u,function(t){var o=(new Date).getTime()-n;e(".loading span.status").text("Loaded "+t.count+" markets in "+o+"ms");var u=t.response,a=new i(u),f=new s({model:a,$matchTemplate:e("#matchTemplate")});f.render(),r.append(f.$el)}),o.promise()}function h(e){e=e||window.location.href;var t=/odds.filter=([^#?&]*)/gi.exec(e);return t&&t[0]}function p(e){return c[e]||c.all}function d(){var t=[u.compareAsText,null,u.compareAsOdds,u.compareAsHandicap,u.compareAsOddsDraw,u.compareAsHandicap,u.compareAsOdds,null];e(document).on("click","tr.bet>td",function(n){var r=e(this),i=r.parent(),s=i.children().index(r),o=t[s];if(!o)return;var u=i.closest("tbody"),a=u.find("tr"),f=i.parent();a.remove(),a.sort(function(t,n){var r=e(t).children().eq(s),i=e(n).children().eq(s),u=r.text(),a=i.text();return o(u,a)}),f.append(a)})}var u={asOddsDraw:function(e,t){return e=e.substring(1,e.length-1),t=t.substring(1,t.length-1),e?t?compareAsOdds(e,t):1:-1},asOdds:function(e,t){return n.strToFloat(e)-n.strToFloat(t)},asText:function(e,t){var n=e==t;return n?0:e>t?-1:1},asHandicap:function(e,t){return e.length>0&&e[0]=="+"&&(e=e.substring(1)),t.length>0&&t[0]=="+"&&(t=t.substring(1)),parseFloat(e)-parseFloat(t)}},i=Backbone.Model.extend({}),a=new r({host:syndy.apiRoot,port:window.location.port}),f=new o,c={superLeagueOnly:function(t){return f.getIconUrl(t.team1)&&f.getIconUrl(t.team2)?!0:!1},all:function(){return!0}};return{matchFilters:c,loadMatches:l,findFilter:p,findFilterName:h,init:d}}),define("syndy/fixtures/FixturesService",["jquery","underscore","q","syndy/ajax"],function(e,t,n,r){function i(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=parseInt(r.round,10),s=[];if(!isNaN(i)){i-=1;while(t.length<=i)t.push([]);s=t[i]}s.push(r)}return t}function s(e,t){return t?t[e]:e}function o(e,n){var r={},i=0;return t.each(e,function(e,t){var o=s(e.teamId1,n),u=s(e.teamId2,n),a=r[o];"undefined"==typeof a&&(a=r[o]=i++);var f=r[u];"undefined"==typeof f&&(f=r[u]=i++)}),console.log(r),r}function u(e){var t={},n=e.fixtures?e.fixtures:e;return t.rounds=i(n),t.fixtures=n,t.teams=e.teams||[],t}function a(e){e=t.extend({},e),this.opts=e,e.host=e.host||"//api.syndy.co.uk",e.port=e.port||"",e.slim=e.slim||!1,e.path=e.path||(e.slim?"/fixtures/slim":"/fixtures"),e.port&&(e.host=e.host+":"+e.port)}return a.prototype.load=function(t){var n=this.opts,i="";t&&(i="?"+("string"!=typeof t)?e.param(t):t);var s=""+n.host+n.path+i;return r.getJSON(s).then(function(e){return!e.errors||e.errors.length<1?u(e):e},function(e,t,n){if(t!=="error")return;var r=[s].concat(Array.prototype.slice.call(arguments));alert(r.join("\n"))})},a}),define("syndy/fixtures/FixtureListModel",["backbone"],function(e){var t=e.Model.extend({initialize:function(){}});return t}),define("syndy/fixtures/FixtureListView",["jquery","underscore","backbone","TeamIcons"],function(e,t,n,r){function s(e){var t=""+(new Date(e)).toUTCString(),n=t.match(/00:00:00/);n&&(t=t.substring(0,n.index).trim()),t=t.replace(/, ([1-9])/,", 0$1");var r=t.indexOf("(");return r>-1&&(t=t.substring(0,r).trim()),t}function o(e,t){return e.getIconUrl(t)}function u(e,t){return e.getIconClass(t)}function a(t,n,r,i,o,u){function a(t,n){t.find("[data-fixtureIdx]").add(t).each(function(){e(this).attr("data-fixtureIdx",n)})}if(!o||o.length<1)return null;var f=e(t({round:{name:""+(i+1)}})),l=f.find(".fixtures tbody"),c=null;return e(o).each(function(t,i){var o=i.team1,u=i.team2,f=o.replace(" ",""),h=u.replace(" ",""),p=e(n({kickOff:s(i.kickOff),team1:o,team2:u,team1Id:f,team2Id:h,team1ColourCssClass:r(o),team2ColourCssClass:r(u),score1:i.score1>-1?i.score1:"",score2:i.score1>-1?i.score2:"",htScore1:i.score1>-1?"("+i.htScore1+")":"",htScore2:i.score1>-1?"("+i.htScore2+")":"",score1class:i.score1>=i.score2?"won":"",score2class:i.score2>=i.score1?"won":""}));c==i.kickOff&&(p=p.slice(1)),a(p,t),c=i.kickOff,l.append(p)}),f}var i=new r,f=n.View.extend({events:{"click .team1":"onClickTeam","click .team2":"onClickTeam"},initialize:function(e){e=e||{},this.options=e,e.teamColourCssClassRetriever=e.teamColourCssClassRetriever||t.bind(u,null,i),this.roundTpl=t.template(e.$roundTemplate.html()),this.fixtureTpl=t.template(e.$fixtureTemplate.html()),this.listenTo(this.model,"change",this.render),this.lastClickedTeamId=null},render:function(){var e=this.options,n=this.model.attributes,r=n.fixtures,i=n.rounds,s=n.teams;return this.$el.html(""),t.each(i,function(t,n){var r=a(this.roundTpl,this.fixtureTpl,e.teamColourCssClassRetriever,n,t,s);r&&this.$el.append(r)},this),this},onClickTeam:function(t){var n=e(t.target);if(n.is(".team1, .team2")){var r=/(teamid_\w*)/.exec(n.attr("class"))[1];this.lastClickedTeamId&&e("."+this.lastClickedTeamId).removeClass("highlight"),e("."+r).addClass("highlight"),this.lastClickedTeamId=r}}});return f.getFixtureInfo=function(e){return{fixtureIdx:f.getFixtureIdx(e),isHome:f.isHome(e)}},f.getFixtureIdx=function(t){return parseInt(e(t).attr("data-fixtureIdx"),10)},f.isHome=function(t){return"true"===e(t).attr("data-home")},f.formatKickOff=s,f}),define("syndy/ui/fixtures",["jquery","syndy/fixtures/FixturesService","syndy/fixtures/FixtureListModel","syndy/fixtures/FixtureListView"],function(e,t,n,r){function u(t){var n=e("select[name='selRound']").first();if(n.find("option").length>0)return;n.html(""),n.append(e("<option value=''>All</option>"));for(var r=0;r<t;r++)n.append(e("<option value="+(r+1)+">"+(r+1)+"</option>"))}function a(t){var n=e("select[name='selTeam']").first();if(n.find("option").length>0)return;n.html(""),n.append(e("<option value=''>All</option>"));for(var r in t)n.append(e("<option value="+r+">"+t[r]+"</option>"))}function f(){var t=e("select[name='selMonth']").first();if(t.find("option").length>0)return;var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.html(""),t.append(e("<option value=''>All</option>")),e(n).each(function(n,r){t.append(e("<option value="+(n+1)+">"+r+"</option>"))})}function l(t){var n=t.text();return function(r){e("div.search").show(),e(".loading").hide(),t.text(n),a(r.teams),f(),u(r.rounds.length),s.set(r)}}function c(t){function n(){var e=window.location.search;e.length>0&&(e="&"+e.substring(1))}t=t||n();var r=e("a.search").first(),s=l(r);return r.text(""),e(".loading").show(),e("div.search").hide(),i.load(t).done(s)}function h(){e("a.search").click(function(t){var n=e("select[name='selTeam']").first(),r=n.val(),i=e("select[name='selMonth']").first(),s=i.val(),o=e("select[name='selRound']").first(),u=o.val(),a={};r&&(a.team=n.find("option:selected").text()),s&&(a.month=s),u&&(a.round=u),c(a)})}var i=new t({host:syndy.apiRoot,port:window.location.port}),s=new n,o=new r({el:e(".rounds")[0],model:s,$roundTemplate:e("#roundTemplate"),$fixtureTemplate:e("#fixtureTemplate")});return{loadFixtures:c,init:h}}),define("main",["syndy/ui/login-button","syndy/ui/latest-odds","syndy/ui/fixtures"],function(){});