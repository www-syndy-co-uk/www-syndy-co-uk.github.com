define("LogonService",["jquery"],function(e){function n(e){this.apiRoot=e}var t=e;return n.prototype.checkLoggedInStatus=function(e,n){e=e||"/",n=n||"/";var e="/authentication/redirectToBlog?destUrl="+e,n="/authentication/redirectToBlog?destUrl="+n,r=this.apiRoot+"/authentication/loginInfo?postLoginUrl="+encodeURIComponent(e)+"&postLogoutUrl="+encodeURIComponent(n);return r+="&callback=?",t.getJSON(r)},n}),define("syndy/ui/login-button",["jquery","LogonService"],function(e,t){var n=e(".login-info"),r=n.find("button.login"),i=n.find("button.logout"),s=null,o=new t(syndy.apiRoot),u=n.find(".throbber");u.show(),n.on("click","button.login",function(e){var t=s.loginUrl;t.indexOf("http")!==0&&(t=syndy.apiRoot+t),window.location.href=t}),n.on("click","button.logout",function(e){var t=s.logoutUrl;t.indexOf("http")!==0&&(t=syndy.apiRoot+t),window.location.href=t});var a=window.location.pathname,f=window.location.pathname;o.checkLoggedInStatus(a,f).done(function(e){u.hide(),s=e,syndy.loginInfo=e;if(s.isUserLoggedIn){var t=s.isUserAdmin?"[A]":"";n.find("span").html(s.user.nickname+" "+t).show(),i.show()}else r.show()})}),define("OddsService",["jquery"],function(e){function n(e,n){return e+=e.indexOf("?")>-1?"&":"?",e+="callback=",e+="?",t.getJSON(e,n).pipe(function(e){return"string"==typeof e?JSON.parse(e):e})}function r(e,t){var r=this;e=e||"//api.syndy.co.uk",t=t||"",t&&(e=e+":"+t),this.matches=[],this.match=null,this.matchSummaries=null,this.loadMatches=function(){var t=e+"/odds/matches";return n(t).done(function(e){r.matches=e})},this.loadMatch=function(t){var i=e+"/odds/matches?matchId="+t;return n(i).done(function(e){r.match=e,r.matches.push(e)})},this.loadMatchSummaries=function(){var t=e+"/odds/matchSummaries";return n(t).done(function(e){r.matchSummaries=e})}}var t=e;return r}),define("TeamIcons",["underscore"],function(e){function t(){var t=this.icons={},n="http://upload.wikimedia.org/wikipedia/commons/thumb";t["Bradford Bulls"]="/e/eb/Bullscolours.svg/16px-Bullscolours.svg.png",t["Castleford Tigers"]="/f/fd/Castleford_colours.svg/16px-Castleford_colours.svg.png",t["Catalan Dragons"]="/0/0c/Catalanscolours.svg/16px-Catalanscolours.svg.png",t["Huddersfield Giants"]="/7/73/Giantscolours.svg/16px-Giantscolours.svg.png",t["Hull FC"]="/6/65/Hullcolours.svg/16px-Hullcolours.svg.png",t["Hull Kingston Rovers"]="/8/8f/HKRcolours.svg/16px-HKRcolours.svg.png",t["Leeds Rhinos"]="/5/5f/Rhinoscolours.svg/16px-Rhinoscolours.svg.png",t["London Broncos"]="/f/f8/Quinscolours.svg/16px-Quinscolours.svg.png",t["Harlequins RL"]="/f/f8/Quinscolours.svg/16px-Quinscolours.svg.png",t["Salford Red Devils"]="/8/81/Redscolours.svg/16px-Redscolours.svg.png",t["St. Helens"]="/5/5e/Saintscolours.svg/16px-Saintscolours.svg.png",t["Wakefield Wildcats"]="/e/e8/Wcatscolours.svg/16px-Wcatscolours.svg.png",t["Warrington Wolves"]="/f/fd/Wolvescolours.svg/16px-Wolvescolours.svg.png",t["Widnes Vikings"]="/e/ec/Widnes_colours.svg/16px-Widnes_colours.svg.png",t["Wigan Warriors"]="/c/c0/Wigancolours.svg/16px-Wigancolours.svg.png",e.each(t,function(e,r){t[r]=n+e}),t.Bradford=t["Bradford Bulls"],t.Castleford=t["Castleford Tigers"],t["Catalans Dragons"]=t["Catalan Dragons"],t.Huddersfield=t["Huddersfield Giants"],t.Hull=t["Hull FC"],t["Hull K R"]=t["Hull Kingston Rovers"],t.Leeds=t["Leeds Rhinos"],t.Salford=t["Salford Red Devils"],t["St Helens"]=t["St. Helens"],t.Wakefield=t["Wakefield Wildcats"],t.Warrington=t["Warrington Wolves"],t.Widnes=t["Widnes Vikings"],t.Wigan=t["Wigan Warriors"]}return t.prototype.getIconUrl=function(e){return this.icons[e]},t.prototype.keys=function(){return e.keys(this.icons)},t}),define("syndy/ui/latest-odds",["jquery","underscore","OddsService","TeamIcons"],function(e,t,n,r){function o(t){function u(t){var r=(new Date).getTime()-n;e(".loadTime").text("Loaded "+t+" markets in "+r+"ms"),e(".loading").hide(),e(".filter").show(),l.resolve(c)}function f(e){var t=++o===s;t&&u(s);var n=e,i=a(n);i&&r.append(i)}var n=(new Date).getTime(),r=e(".matches").first();r.html(""),e(".loading").show(),e(".filter").hide();var s=0,o=0,l=e.Deferred(),c={};return i.loadMatchSummaries().done(function(n,o,a){s=0,c.matchSummaries=n;if(n.length<1){u(0);return}for(var l=0;l<n.length;l++){var h=n[l],p=t(h);p&&function(e,t){t.html(h.team1+" v "+h.team2),r.append(t),s++,i.loadMatch(h.id).done(function(n){c.matches=c.matches||[],c.matches[e]=n,t.remove(),f.call(this,n)})}(l,e("<div/>"))}0==s&&u(0)}).fail(function(e,t,n){alert(t),console.log(e,t,n)}),l.promise()}function u(){function e(e){return s.getIconUrl(e.team1)||s.getIconUrl(e.team2)?!0:!1}var t=window.location.href.indexOf("superLeagueOnly")>-1;return t?e:function(){return!0}}function a(n){function r(e){if(!e)return"?";var t=e.asFraction,n=e.asDouble;return t?""+t.numerator+"/"+t.denominator:n}function i(t){var n=t.bet1||{},i=t.bet2||{},o=s.getIconUrl(n.name),u=s.getIconUrl(i.name),a="http://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif",f={bet1:e.extend({},n,{odds:r(n.odds)}),bet2:e.extend({},i,{odds:r(i.odds)}),draw:{odds:t.draw?r(t.draw.odds):""},src1:o?o:a,src2:u?u:a},c=e(l(f));return c}if(!n.bets||n.bets.length<1)return null;var o=e("#matchTemplate").html().trim(),u=t.template(o),a=e(u({match:n})),f=e("#betTemplate").html().trim(),l=t.template(f),c=a.find(".bets tbody");n.bets.sort(function(e,t){return e.bookmaker<t.bookmaker?-1:e.bookmaker>t.bookmaker?1:0});var h={};e(n.bets).each(function(e,t){t.handicap&&t.handicap.length>0&&t.handicap[0]=="+"&&(t.handicap=t.handicap.substring(1));if(null!=h.bookmaker&&t.bookmaker!=h.bookmaker){var r=i(h);c.append(r),h={}}"Draw"===t.name?h.draw=t:n.team1===t.name?h.bet1=t:h.bet2=t,h.bookmaker=t.bookmaker});var p=i(h);return c.append(p),a}function f(){function t(e){var t=e.indexOf("/");return t<0?parseFloat(e):parseInt(e.substring(0,t).trim())/parseInt(e.substring(t+1).trim())}function n(e,t){return e=e.substring(1,e.length-1),t=t.substring(1,t.length-1),e?t?r(e,t):1:-1}function r(e,n){return t(e)-t(n)}function i(e,t){var n=e==t;return n?0:e>t?-1:1}function s(e,t){return e.length>0&&e[0]=="+"&&(e=e.substring(1)),t.length>0&&t[0]=="+"&&(t=t.substring(1)),parseFloat(e)-parseFloat(t)}var o=[i,null,r,s,n,s,r,null];e(document).on("click","tr.bet>td",function(t){var n=e(this),r=n.parent(),i=r.children().index(n),s=o[i];if(!s)return;var u=r.closest("tbody"),a=u.find("tr"),f=r.parent();a.remove(),a.sort(function(t,n){var r=e(t).children().eq(i),o=e(n).children().eq(i),u=r.text(),a=o.text();return s(u,a)}),f.append(a)})}var i=new n(syndy.apiRoot,window.location.port),s=new r;return{loadMatches:o,findFilter:u,init:f}}),define("FixturesService",["jquery"],function(e){function t(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=parseInt(r.round,10),s=[];if(!isNaN(i)){i-=1;while(t.length<=i)t.push([]);s=t[i]}s.push(r)}return t}function n(e,t){return t?t[e]:e}function r(e,t){var r={},i=0;return _.each(e,function(e,s){var o=n(e.teamId1,t),u=n(e.teamId2,t),a=r[o];"undefined"==typeof a&&(a=r[o]=i++);var f=r[u];"undefined"==typeof f&&(f=r[u]=i++)}),console.log(r),r}function i(e){var n={},r=e.fixtures?e.fixtures:e;return n.rounds=t(r),n.fixtures=r,n.teams=e.teams||[],n}function s(e){e=e||{},this.opts=e,e.host=e.host||"//api.syndy.co.uk",e.port=e.port||"",e.slim=e.slim||!1,e.path=e.path||(e.slim?"/fixtures/slim":"/fixtures"),e.port&&(e.host=e.host+":"+e.port)}return s.prototype.load=function(t){var n=this,r=this.opts,s="";t&&(s="string"!=typeof t?e.param(t):t,s+="&"),s+="callback=?";var o=""+r.host+r.path+"?"+s;return e.getJSON(o).then(function(e){return!e.errors||e.errors.length<1?i(e):e}).fail(function(e,t,n){if(t!=="error")return;var r=[o].concat(Array.prototype.slice.call(arguments));alert(r.join("\n"))})},s}),define("FixtureListModel",["backbone"],function(e){var t=e.Model.extend({initialize:function(){}});return t}),define("FixtureListView",["jquery","underscore","backbone","TeamIcons"],function(e,t,n,r){function s(e){var t=""+(new Date(e)).toUTCString();t=t.replace(/00:00:00/,"??:??:??");var n=t.indexOf("(");return n>-1&&(t=t.substring(0,n).trim()),t}function o(e,t){return e.getIconUrl(t)}function u(t,n,r,i,o,u){function a(t,n){t.find("[data-fixtureIdx]").add(t).each(function(){e(this).attr("data-fixtureIdx",n)})}if(!o||o.length<1)return null;var f=e(t({round:{name:""+(i+1)}})),l=f.find(".fixtures tbody"),c=null;return e(o).each(function(t,i){var o=i.team1,u=i.team2,f=o,h=u,p=e(n({kickOff:s(i.kickOff),team1:o,team2:u,team1Id:f,team2Id:h,src1:r(o),src2:r(u),score1:i.score1>-1?i.score1:"",score2:i.score1>-1?i.score2:"",htScore1:i.score1>-1?"("+i.htScore1+")":"",htScore2:i.score1>-1?"("+i.htScore2+")":"",score1class:i.score1>=i.score2?"won":"",score2class:i.score2>=i.score1?"won":""}));c==i.kickOff&&(p=p.slice(1)),a(p,t),c=i.kickOff,l.append(p)}),f}var i=new r,a=n.View.extend({initialize:function(e){this.options=e,e.iconRetriever=e.iconRetriever||t.bind(o,null,i),this.roundTpl=t.template(e.$roundTemplate.html()),this.fixtureTpl=t.template(e.$fixtureTemplate.html()),this.listenTo(this.model,"change",this.render)},render:function(){var e=this.options,n=this.model.attributes,r=n.fixtures,i=n.rounds,s=n.teams;return this.$el.html(""),t.each(i,function(t,n){var r=u(this.roundTpl,this.fixtureTpl,e.iconRetriever,n,t,s);r&&this.$el.append(r)},this),this}});return a.getFixtureInfo=function(e){return{fixtureIdx:a.getFixtureIdx(e),isHome:a.isHome(e)}},a.getFixtureIdx=function(t){return parseInt(e(t).attr("data-fixtureIdx"),10)},a.isHome=function(t){return"true"===e(t).attr("data-home")},a}),define("syndy/ui/fixtures",["jquery","FixturesService","FixtureListModel","FixtureListView"],function(e,t,n,r){function u(t){var n=e("select[name='selRound']").first();if(n.find("option").length>0)return;n.html(""),n.append(e("<option value=''>All</option>"));for(var r=0;r<t;r++)n.append(e("<option value="+(r+1)+">"+(r+1)+"</option>"))}function a(t){var n=e("select[name='selTeam']").first();if(n.find("option").length>0)return;n.html(""),n.append(e("<option value=''>All</option>"));for(var r in t)n.append(e("<option value="+r+">"+t[r]+"</option>"))}function f(){var t=e("select[name='selMonth']").first();if(t.find("option").length>0)return;var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.html(""),t.append(e("<option value=''>All</option>")),e(n).each(function(n,r){t.append(e("<option value="+(n+1)+">"+r+"</option>"))})}function l(t){var n=t.text();return function(r){e("div.search").show(),e(".loading").hide(),t.text(n),a(r.teams),f(),u(r.rounds.length),s.set(r)}}function c(t){function n(){var e=window.location.search;e.length>0&&(e="&"+e.substring(1))}t=t||n();var r=e("a.search").first(),s=l(r);return r.text(""),e(".loading").show(),e("div.search").hide(),i.load(t).done(s)}function h(){var t=null;e(document).click(function(n){var r=e(n.target);if(r.is(".team1, .team2")){var i=/(teamid_\w*)/.exec(r.attr("class"))[1];t&&e("."+t).removeClass("highlight"),e("."+i).addClass("highlight"),t=i}}),e("a.search").click(function(t){var n=e("select[name='selTeam']").first(),r=n.val(),i=e("select[name='selMonth']").first(),s=i.val(),o=e("select[name='selRound']").first(),u=o.val(),a={};r&&(a.team=n.find("option:selected").text()),s&&(a.month=s),u&&(a.round=u),c(a)})}var i=new t({host:syndy.apiRoot,port:window.location.port}),s=new n,o=new r({el:e(".rounds")[0],model:s,$roundTemplate:e("#roundTemplate"),$fixtureTemplate:e("#fixtureTemplate")});return{loadFixtures:c,init:h}}),define("main",["syndy/ui/login-button","syndy/ui/latest-odds","syndy/ui/fixtures"],function(){});